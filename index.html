<meta charset="UTF-8">
<title>Colors</title>
<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-342D6M2MKX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-342D6M2MKX');
</script>
</head>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<link href="https://erichsia7.github.io/colors/c2_512.png" sizes="512x512" rel="apple-touch-icon-precomposed" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="defualt" />
<link type="image/x-icon" href="https://erichsia7.github.io/colors/c2_ico.ico" rel="icon" />
<link type="image/x-icon" href="https://erichsia7.github.io/colors/c2_ico.ico" rel="bookmark" />
<link type="image/x-icon" href="https://erichsia7.github.io/colors/c2_ico.ico" rel="shortcut icon" />
<style>

@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400,500,700&display=swap');
.color {
  position:fixed;
  top:0px;
  left:0px;
  width:100%;
  height:100%; 
  background:#fff;
  overflow:scroll;
  color:#000;
  font-weight:bold;
  font-family: 'Noto Sans TC', sans-serif;
  font-size:1.6rem;
  display:none;
}
.color #rgb {
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  background:rgba(0, 0, 0, 0.08);
  padding:8px;
  border-radius:99em;
  border:none;
  font-weight:bold;
  font-family: 'Noto Sans TC', sans-serif;
  font-size:1.3rem;
  width:120px;
   text-align:center;
}

.colorte {
  position:fixed;
  top:0px;
  left:0px;
  width:100%;
  height:100%; 
  background:#fff;
  overflow:scroll;
  color:#000;
  font-weight:bold;
  font-family: 'Noto Sans TC', sans-serif;
  font-size:1.6rem;
  display:none;
}
.colorte #textu {
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  background:rgba(0, 0, 0, 0.08);
  padding:8px;
  border-radius:99em;
  border:none;
  font-weight:bold;
  font-family: 'Noto Sans TC', sans-serif;
  font-size:1.3rem;
  width:120px;
   text-align:center;
}
.fti {
width:45px;
  height:45px;
  background:rgba(250,250,250,0.8) url(https://erichsia7.github.io/colors/close2.png);
  background-size:25px;
  background-position:center;
  background-repeat:no-repeat;
  border-radius:99em;
  font-weight:medium;
  font-family: 'Noto Sans TC', sans-serif;
  font-size:1.3rem;
  display: flex;
  justify-content: center;
  align-items: center;
  color:#333;
    
}




#cc {
  position:fixed;
  top:0px;
  left:0px;
  display:none;
}
input#files,input#files2 {
display:none;
}
.filed-camera {
width:45px;
  height:45px;
  background:rgba(250,250,250,0.8) url(https://erichsia7.github.io/colors/camera.png);
  background-size:25px;
  background-position:center;
  background-repeat:no-repeat;
  border-radius:99em;
  font-weight:medium;
  font-family: 'Noto Sans TC', sans-serif;
  font-size:1.3rem;
  display: flex;
  justify-content: center;
  align-items: center;
  color:#333;
}
.filed-img {
width:45px;
  height:45px;
  background:rgba(250,250,250,0.8) url(https://erichsia7.github.io/colors/img.png);
  background-size:25px;
  background-position:center;
  background-repeat:no-repeat;
  border-radius:99em;
  font-weight:medium;
  font-family: 'Noto Sans TC', sans-serif;
  font-size:1.3rem;
  display: flex;
  justify-content: center;
  align-items: center;
  color:#333;
    
}



.fi {
width:45px;
  height:45px;
  background:rgba(250,250,250,0.8) url(https://erichsia7.github.io/colors/close2.png);
  background-size:25px;
  background-position:center;
  background-repeat:no-repeat;
  border-radius:99em;
  font-weight:medium;
  font-family: 'Noto Sans TC', sans-serif;
  font-size:1.3rem;
  display: flex;
  justify-content: center;
  align-items: center;
  color:#333;
    
}
.fi2 {
width:45px;
  height:45px;
  background:rgba(250,250,250,0.8) url(https://erichsia7.github.io/colors/copy2.png);
  background-size:25px;
  background-position:center;
  background-repeat:no-repeat;
  border-radius:99em;
  font-weight:medium;
  font-family: 'Noto Sans TC', sans-serif;
  font-size:1.3rem;
  display: flex;
  justify-content: center;
  align-items: center;
  color:#333;
    
}
.fi3 {
width:45px;
  height:45px;
  background:rgba(250,250,250,0.8) url(https://erichsia7.github.io/colors/share3.png);
  background-size:25px;
  background-position:center;
  background-repeat:no-repeat;
  border-radius:99em;
  font-weight:medium;
  font-family: 'Noto Sans TC', sans-serif;
  font-size:1.3rem;
  display: flex;
  justify-content: center;
  align-items: center;
  color:#333;
    
}
.ft2 {
width:45px;
  height:45px;
  background:rgba(250,250,250,0.8) url(https://erichsia7.github.io/colors/text2.png);
  background-size:25px;
  background-position:center;
  background-repeat:no-repeat;
  border-radius:99em;
  font-weight:medium;
  font-family: 'Noto Sans TC', sans-serif;
  font-size:1.3rem;
  display: flex;
  justify-content: center;
  align-items: center;
  color:#333;
    
}
  .rand2 {
width:45px;
  height:45px;
  background:rgba(250,250,250,0.8) url(https://erichsia7.github.io/colors/random3.png);
  background-size:25px;
  background-position:center;
  background-repeat:no-repeat;
  border-radius:99em;
  font-weight:medium;
  font-family: 'Noto Sans TC', sans-serif;
  font-size:1.3rem;
  display: flex;
  justify-content: center;
  align-items: center;
  color:#333;
    
}
  




.copied {
position:fixed;
  left:0px;
  top:0px;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.5);
  display:none;
  justify-content: center;
  align-items: center;
  font-weight:medium;
  font-family: 'Noto Sans TC', sans-serif;
  font-size:1.3rem;
  color:#fff
}
#filej {
width:230px;
height:45px;
  }
#filerj {
position:fixed;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
}
#menuj ,#tej{
position:fixed;
  left:50%;
  bottom:30px;
  transform:translateX(-50%);
  
}

.lle {
  float:left;
  margin-left:10px;
}
  #icon {
width:70%;
    max-width:120px;
   margin-bottom:10px;
}
  

</style>
<canvas id="cc" width="128" height="128" style="background:#fff;"></canvas>
<span id="filerj">
  <center><img src="colors3_svg.svg" id="icon"></center>
  
<div id="filej">
<label for="files2">
<div class="filed-img lle">
</div>
<input type="file" id="files2" name="files2" accept="image/*" />
</label>
<label for="files">
<div class="filed-camera lle">
</div>
<input type="file" id="files" name="files" accept="image/*" capture="camera"/>
</label>
  <div class="ft2 lle"></div>
  <div class="rand2 lle"></div>
</div>
  
</span>


<div class="color"> 
  <input type="text" id="rgb" value="#fff" readonly="readonly">
  
  
  <span id="menuj">
  <div class="fi2 lle"></div>
  <div class="fi3 lle"></div>
  <div class="fi lle"></div>
  </span>
  
</div>
<div class="colorte"> 
  <input type="text" id="textu" value="">
  <span id="tej">
    <div class="fti lle"></div>
  </span>
</div>




<div class="copied">已複製</div>


<script>
  var getUrlString = location.href;
var url = new URL(getUrlString);
var sharecolor = url.searchParams.get('s') ;
var shcolor = atob(url.searchParams.get('c')) ;
  
  
var ccw = 256;
var ccwa = (ccw*ccw) ;
document.getElementById('cc').width = ccw ;
document.getElementById('cc').height = ccw ;

  
  
  function genid(mode) {
if(mode === "random"){
var genidchars = "0123456789abcdefghijklmnopqrstuvwxyz";
            var genid = "";
            for (var i = 0; i < 16; i++) {
                var genrandomNumber = Math.floor(Math.random() * genidchars.length);
                genid += genidchars.substring(genrandomNumber, genrandomNumber + 1);
            }
  return genid ;
}
          
 if(mode === "time"){
   var gtoday=new Date();
   var genid2 = (gtoday.getMonth()+1) + '_' + gtoday.getDate() + '_' + gtoday.getHours() + '_' + gtoday.getMinutes() + '_' + gtoday.getSeconds() + '-' + (1+Math.floor(Math.random() * 8)) + '' + (1+Math.floor(Math.random() * 8)) + '' + (1+Math.floor(Math.random() * 8)) + '' + (1+Math.floor(Math.random() * 8)) + '' + (1+Math.floor(Math.random() * 8)) + '' + (1+Math.floor(Math.random() * 8)) + '' + (1+Math.floor(Math.random() * 8)) + '' + (1+Math.floor(Math.random() * 8));
   
   return genid2
 }
  
  if(mode === "number"){
   
   var genid3 = '' ;
for (var i = 0; i < 16; i++) {
  genid3 += '' + (0+Math.floor(Math.random() * 9))
}
   return genid3
 }
  
  if(mode === "uuid"){
var genidchars4 = "abcdef012345678";
    var geniduu = [8,4,4,4,12];
            var genid4 = "";
            var genid5 = "";
    for (var ia = 0; ia < geniduu.length; ia++) {
      var genid4 = "";
            for (var i = 0; i < geniduu[ia]; i++) {
                var genrandomNumber4 = Math.floor(Math.random() * genidchars4.length);
                genid4 += genidchars4.substring(genrandomNumber4, genrandomNumber4 + 1);
            }
genid5 += '-' + genid4 ;
    }
    return genid5.substring(1,genid5.length)
  }

}
function componentToHex(c) {
  var hex = c.toString(16);
  return hex.length == 1 ? "0" + hex : hex;
}

function rgbToHex(r, g, b) {
  return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
}
function hexToRgb(hex) {
  var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result ? {
    r: parseInt(result[1], 16),
    g: parseInt(result[2], 16),
    b: parseInt(result[3], 16)
  } : null;
}



if (window.File && window.FileReader && window.FileList && window.Blob) {
  document.getElementById('files').addEventListener('change', handleFileSelect, false);
  document.getElementById('files2').addEventListener('change', handleFileSelect, false);

} else {
  alert('您的瀏覽器不支援');
}

function handleFileSelect(evt) {
  $('.loadbar').css({'width':'0%'})
  var f = evt.target.files[0]; // FileList object
  var reader = new FileReader();
  // Closure to capture the file information.
  reader.onload = (function(theFile) {
    return function(e) {
      var binaryData = e.target.result;
      //Converting Binary Data to base 64
      var base64String = window.btoa(binaryData);
      //showing file converted to base64
      

      
      var ctx = document.getElementById('cc').getContext('2d');
      
  var img = new Image();
  img.onload = function(){
    ctx.drawImage(img,0,0,ccw,ccw);
  };
  img.src = 'data:image/jpeg;base64,' + base64String;
 
var rgb_r = 0 ;     
var rgb_g = 0 ;   
var rgb_b = 0 ; 
var load = 0 ;
  setTimeout(function() {
   for (var xi=0; xi<ccw; xi++){
     for (var yi=0; yi<ccw; yi++){
  rgb_r += ctx.getImageData(xi, yi, 1, 1).data[0] ;
  rgb_g += ctx.getImageData(xi, yi, 1, 1).data[1] ;
  rgb_b += ctx.getImageData(xi, yi, 1, 1).data[2] ; 
     }
   }
    var rgbs = Math.ceil(rgb_r/ccwa) + ',' + Math.ceil(rgb_g/ccwa) + ',' + Math.ceil(rgb_b/ccwa) ;
    
    
    $('#rgb').val(rgbToHex(Math.ceil(rgb_r/ccwa), Math.ceil(rgb_g/ccwa), Math.ceil(rgb_b/ccwa)));
    $('.color').css({'background':rgbToHex(Math.ceil(rgb_r/ccwa), Math.ceil(rgb_g/ccwa), Math.ceil(rgb_b/ccwa)) });
  
    if((Math.ceil(rgb_r/ccwa)+Math.ceil(rgb_g/ccwa)+Math.ceil(rgb_b/ccwa))/3 > 128) {
      $('#rgb').css({'color':'#000'});
    }
    else {
      $('#rgb').css({'color':'#fff'});
    }
    //$('.color').fadeIn(222);
    location.href = 'https://erichsia7.github.io/colors/?s=1&c=' + btoa(rgbToHex(Math.ceil(rgb_r/ccwa), Math.ceil(rgb_g/ccwa), Math.ceil(rgb_b/ccwa))) + '&r=' + genid('random');
  },200);
    };

    
    
  })(f);
  // Read in the image file as a data URL.
  reader.readAsBinaryString(f);
}

$('.fi').click(function() {
$('.color').fadeOut(222);
if(sharecolor === "1") {
  setTimeout(function(){
    location.href = 'https://erichsia7.github.io/colors/?r=' + genid('random') ;
  }, 222);
  
}
})

$('.fi2').click(function() {
   var copys2 = $('#rgb');
copys2.select();
document.execCommand("Copy");
});

$('.fi3').click(function() {
  var shur = 'https://erichsia7.github.io/colors/?s=1&c=' + btoa($('#rgb').val()) + '&r=' + genid('random') ;
if (navigator.share) { 
   navigator.share({
      title: document.title,
      url: shur
    }).then(() => {
      
    })
    .catch(console.error);
    } else {
        shareDialog.classList.add('is-open');
    }

})
$('.fti').click(function() {
  $('.colorte').fadeOut(222);
})
$('.ft2').click(function() {
  $('.colorte').fadeIn(222);
  $('#textu').val('')
})
  
  
 

$('#textu').on('keypress',function(e) {
    if(e.which == 13) {
      //$('.colorte').fadeOut(222);
      $('#textu').blur();
if((hexToRgb($('#textu').val()).r+hexToRgb($('#textu').val()).g+hexToRgb($('#textu').val()).b)/3 > 128) {
      $('#rgb').css({'color':'#000'});
    }
    else {
      $('#rgb').css({'color':'#fff'});
    }
    //$('.color').fadeIn(222);
    $('.color').css({'background':$('#textu').val()})
      $('#rgb').val($('#textu').val());
      location.href = 'https://erichsia7.github.io/colors/?s=1&c=' + btoa($('#textu').val()) + '&r=' + genid('random');
    }
});
  
  $('.rand2').click(function() {
var rand_r = Math.floor(Math.random() * 255);
var rand_g = Math.floor(Math.random() * 255);  
var rand_b = Math.floor(Math.random() * 255);


    location.href = 'https://erichsia7.github.io/colors/?s=1&c=' + btoa(rgbToHex(rand_r,rand_g,rand_b)) + '&r=' + genid('random') ;
    if((rand_r+rand_g+rand_b)/3 > 128) {
      $('#rgb').css({'color':'#000'});
    }
    else {
      $('#rgb').css({'color':'#fff'});
    }
    //$('.color').fadeIn(222);
    $('.color').css({'background':rgbToHex(rand_r,rand_g,rand_b)})
      $('#rgb').val(rgbToHex(rand_r,rand_g,rand_b));   
    

});
  
  
  
  
  

  
if(sharecolor === "1") {
if((hexToRgb(shcolor).r+hexToRgb(shcolor).g+hexToRgb(shcolor))/3 > 128) {
      $('#rgb').css({'color':'#000'});
    }
    else {
      $('#rgb').css({'color':'#fff'});
    }
    $('.color').fadeIn(222);
    $('.color').css({'background':shcolor})
      $('#rgb').val(shcolor);
}
var rgbinput =document.getElementById('rgb');
rgbinput.addEventListener('copy', (event) => {
    $('.copied').fadeIn(111).css({'display':'flex'}).delay(500).fadeOut(111)
});
</script>
