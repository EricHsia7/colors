<meta charset="UTF-8">
<title>Colors</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/webcamjs/1.0.26/webcam.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>
<link href="https://erichsia7.github.io/colors/c2_512.png" sizes="512x512" rel="apple-touch-icon-precomposed" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="defualt" />
<link type="image/x-icon" href="https://erichsia7.github.io/colors/c2_ico.ico" rel="icon" />
<link type="image/x-icon" href="https://erichsia7.github.io/colors/c2_ico.ico" rel="bookmark" />
<link type="image/x-icon" href="https://erichsia7.github.io/colors/c2_ico.ico" rel="shortcut icon" />
<link rel="manifest" href="https://erichsia7.github.io/colors/manifest.json?qoaa9">
<style>
	  * {outline:none; -webkit-tap-highlight-color:rgba(0,0,0,0);}
body {
  background:#000;
  -webkit-user-select: none;
}

.bottom {
  position:fixed;
  bottom:0px;
  left:0px;
  width:100%;
  height:100px;
  background:#000;
  display: flex;
justify-content: center;
align-items: center;
  -webkit-user-select: none;
}

.shutter {
  width:55px;
  height:55px;
  background:#fff;
  border-radius:99em;
  box-shadow: 0px 0px 0px 3px #000,0px 0px 0px 8px rgba(255,255,255,1);
  -webkit-user-select: none;
}
.camera {
  position:fixed;
  left:0px;
  top:0px;
  width:100%;
  height:calc(100% - 100px);
  background:#000;
  transition:0.3s;
  -webkit-user-select: none;
}
.at {
  position:fixed;
  left:0px;
  bottom:calc(-45% * (1 - var(--op-t)));
  width:100%;
  height:45%;
  border-radius:15px 15px 0px 0px;
  background:#1a1a1a;
  transition:0.3s;
  -webkit-user-select: none;
}
.camera video {
  width:100%;
  height:100%;
  position:absolute;
  top:0px;
  left:0px;
  object-fit: cover;
  transition:0.3s;
  -webkit-user-select: none;
}
canvas#ccttt {
  position:fixed;
  top:0px;
  left:0px;
  height:0%;
  width:0%;
  display:block;
  opacity:0;
  object-fit: cover;
  -webkit-user-select: none;
}
.attitle {
  color:#fff;
  font-size:25px;
  position:absolute;
  top:0px;
  left:0px;
  height:50px;
  width:calc(100% - 15px);
  background:none;
  display: flex;
  justify-content: left;
  align-items: center;
  padding-left:15px;
  border-bottom: solid 1px #1f1f1f;
  -webkit-user-select: none;
  font-family: 'Noto Sans TC', sans-serif;
  font-weight:700;
}

#cf {
  width:100%;
  opacity:1;
  -webkit-user-select: none;
}
.bg {
  position:fixed;
  top:0px;
  left:0px;
  width:100%;
  height:100%;
  background:#000;
  -webkit-user-select: none;
}
.palettelist {
  position:absolute;
  top:51px;
  left:0px;
  list-style:none;
  color:#fff;
  font-size:23px;
  width:100%;
  height:calc(100% - 51px);
  overflow:scroll;
  -webkit-user-select: none;
}
.palettelist li {
  margin-top:5px;
  margin-left:15px;
  height:40px;
  display: flex;
  justify-content: left;
  align-items: center;
  position:relative;
  -webkit-user-select: none;
  font-family: 'Noto Sans TC', sans-serif;
  font-weight:500;
}
.palettelistb {
  width:35px;
  height:35px;
  border-radius:10px;
  background:#1f1f1f;
  -webkit-user-select: none;
}
.mgl {
  float:left;
}
.text {
  margin-left:5px;
}
.openbtn {
  background:#fff;
  color:#000;
  font-size:18px;
  width:55px;
  height:35px;
  border-radius:10px;
  display: flex;
  justify-content: center;
  align-items: center;
  position:absolute;
  right:15px;
  top:50%;
  transform:translateY(-50%);
  -webkit-user-select: none;
  font-family: 'Noto Sans TC', sans-serif;
  font-weight:400;
}
	
	.backbtn {
  background: rgba(0,0,0,0.6) url(https://erichsia7.github.io/colors/arrow-right-light.png);
background-size:25px;
  background-position:center;
  background-repeat:no-repeat;
  position:fixed;
  top:15px;
  left:15px;
  width:40px;
  height:40px;
  display: flex;
justify-content: center;
align-items: center;
  color:#fff;
  font-size:20px;
font-family: 'Noto Sans TC', sans-serif;
  font-weight:400;
  -webkit-backdrop-filter: blur(15px);
  backdrop-filter: blur(15px);
transform:rotate(180deg);
border-radius:99em;
}
.ladbar {
background:#fff;
position:fixed;
top:0px;
left:0px;
width:0px;
height:1.3px;
transition:width 0.3s ,background 0s;
}
</style>
<img src="" id="cf">
<div class="bg"></div>
<div class="camera">
  
  <video autoplay="autoplay" playsinline="playsinline" id="vid"></video>
  
</div>
<div class="bottom">
  <div class="shutter"></div>
</div>
<div class="at" style="--op-t:0">
  <div class="attitle">Colors</div>
  <div class="palettelist">
    
  </div>
</div>
<canvas id="ccttt"></canvas>
<div class="backbtn"></div>
<div class="ladbar" style="display:block;"></div>
<script>
lade = 0 ;
function ladbaradd() {
lade += 5+Math.floor(Math.random() * 2) ;
$('.ladbar').css({'width':lade + '%'});
if(lade > 80) {
clearInterval(ladbar);
}
}
ladbaradd();
var ladbar = setInterval(ladbaradd,300);

$(document).ready(function() {
setTimeout(function() {
clearInterval(ladbar);
$('.ladbar').css({'width':'105%','transition':'0.7s'});
},1000);

setTimeout(function() {
$('.ladbar').css({'opacity':'0'});
},1500);

setTimeout(function() {
$('.ladbar').css({'display':'none'});
},2300);
});
</script>

<script>
 Webcam.set({
			image_format: 'jpeg',
			jpeg_quality: 90,
			constraints: {
video: true,
facingMode: "environment"
}
		});
		Webcam.attach( '.camera' );
	
    function genid(mode) {
if(mode === "random"){
var genidchars = "0123456789abcdefghijklmnopqrstuvwxyz";
            var genid = "";
            for (var i = 0; i < 16; i++) {
                var genrandomNumber = Math.floor(Math.random() * genidchars.length);
                genid += genidchars.substring(genrandomNumber, genrandomNumber + 1);
            }
  return genid ;
}
          
 if(mode === "time"){
   var gtoday=new Date();
   var genid2 = (gtoday.getMonth()+1) + '_' + gtoday.getDate() + '_' + gtoday.getHours() + '_' + gtoday.getMinutes() + '_' + gtoday.getSeconds() + '-' + (1+Math.floor(Math.random() * 8)) + '' + (1+Math.floor(Math.random() * 8)) + '' + (1+Math.floor(Math.random() * 8)) + '' + (1+Math.floor(Math.random() * 8)) + '' + (1+Math.floor(Math.random() * 8)) + '' + (1+Math.floor(Math.random() * 8)) + '' + (1+Math.floor(Math.random() * 8)) + '' + (1+Math.floor(Math.random() * 8));
   
   return genid2
 }
  
  if(mode === "number"){
   
   var genid3 = '' ;
for (var i = 0; i < 16; i++) {
  genid3 += '' + (0+Math.floor(Math.random() * 9))
}
   return genid3
 }
  
  if(mode === "uuid"){
var genidchars4 = "abcdef012345678";
    var geniduu = [8,4,4,4,12];
            var genid4 = "";
            var genid5 = "";
    for (var ia = 0; ia < geniduu.length; ia++) {
      var genid4 = "";
            for (var i = 0; i < geniduu[ia]; i++) {
                var genrandomNumber4 = Math.floor(Math.random() * genidchars4.length);
                genid4 += genidchars4.substring(genrandomNumber4, genrandomNumber4 + 1);
            }
genid5 += '-' + genid4 ;
    }
    return genid5.substring(1,genid5.length)
  }

}
  function componentToHex(c) {
  var hex = c.toString(16);
  return hex.length == 1 ? "0" + hex : hex;
}

function rgbToHex(r, g, b) {
  return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
}


document.getElementById('ccttt').width = ($(window).width()*($(window).height()*0.55))/($(window).height()-100) ;
		document.getElementById('ccttt').height = $(window).height()*0.55 ;
		var ctx = document.getElementById('ccttt').getContext('2d');
		function gtg() {
Webcam.snap( function(data_uri, canvas, context) {	
		ctx.drawImage( canvas, 0, 0 );
});
}

function shutter() {
  $('.at').css({'--op-t':'1'});
  $('.camera').css({'height':$(window).height()*0.55,'width':($(window).width()*($(window).height()*0.55))/($(window).height()-100),'left':$(window).width()*0.5-(($(window).width()*($(window).height()*0.55))/($(window).height()-100))*0.5});
  $('canvas#ccttt').css({'width':$(window).width(),'height':$(window).height()*0.55})
  
  
  //$('#vid').attr('width',($(window).width()*($(window).height()*0.55))/($(window).height()-100))
  $('.camera video').width(($(window).width()*($(window).height()*0.55))/($(window).height()-100)).height($(window).height()*0.55);
  Webcam.snap( function(data_uri, canvas, context) {	$('#cf').attr('src',data_uri);
		ctx.drawImage( canvas, 0-(($(window).height()*0.55*document.querySelector('.camera video').videoWidth/document.querySelector('.camera video').videoHeight)-(($(window).width()*($(window).height()*0.55))/($(window).height()-100)))/2 , 0 ,$(window).height()*0.55*document.querySelector('.camera video').videoWidth/document.querySelector('.camera video').videoHeight,$(window).height()*0.55);
});
 setTimeout(function() {
   $('canvas#ccttt').css({'height':$(window).height()*0.55,'width':($(window).width()*($(window).height()*0.55))/($(window).height()-100),'left':$(window).width()*0.5-(($(window).width()*($(window).height()*0.55))/($(window).height()-100))*0.5,'display':'block','opacity':'1','transition':'0.3s'});
   $('.camera video').fadeOut(300)
 },1) 
  
  setTimeout(function() {
  Webcam.reset();
    
    
    
    
    
    
    const colorThief = new ColorThief();
    const img = document.querySelector('#cf');

    // Make sure image is finished loading
    if (img.complete) {
      
      var imgcolorpalette = colorThief.getPalette(img) ;
      
      for (var i = 0; i < imgcolorpalette.length; i++) {
	var drft = genid('random');
        $('.palettelist').append('<li><div class="palettelistb mgl" style="background:' + rgbToHex(imgcolorpalette[i][0],imgcolorpalette[i][1],imgcolorpalette[i][2]) + '"></div><div class="text mgl">' + rgbToHex(imgcolorpalette[i][0],imgcolorpalette[i][1],imgcolorpalette[i][2]) + '</div><div class="openbtn" id="' + drft + '" hexbase64="' + btoa(rgbToHex(imgcolorpalette[i][0],imgcolorpalette[i][1],imgcolorpalette[i][2])) + '">查看</div></li>');
	$('.openbtn#' + drft).click(function() {
	window.open('https://erichsia7.github.io/colors/?s=1&c=' + $(this).attr('hexbase64') + '&open=camera&r=' + genid('random'))
	});
      }
      
      
    } else {
      img.addEventListener('load', function() {
        colorThief.getColor(img);
      });
    }
    
    
    
    
    
  },400);
  
}
$('.shutter').click(function() {
  shutter();
});
$('.backbtn').click(function() {
location.href = 'https://erichsia7.github.io/colors/?r=' + genid('random')
});


  $(document).ready(function() {
    //test 
        if(localStorage.getItem('googlefontNotoSansTCloaded') === '1') {
  $('body').append('<style>' + localStorage.getItem('googlefontNotoSansTC') + '</style>');
  console.log('loaded')
}
else {
 $.ajax({type:'get',url:"https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap",dataType:'text',success:function(e) {
  
  localStorage.setItem('googlefontNotoSansTC', e); localStorage.setItem('googlefontNotoSansTCloaded', '1');
   $('body').append('<style>' + e + '</style>');
   
   console.log('loaded2')
   }
}); 
}
  });
	</script>
